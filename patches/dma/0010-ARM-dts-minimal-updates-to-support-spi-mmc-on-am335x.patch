From 319d3c6bc3ce53af9507d71f831b2405a21bc168 Mon Sep 17 00:00:00 2001
From: Matt Porter <mporter@ti.com>
Date: Fri, 7 Sep 2012 09:44:05 -0400
Subject: [PATCH 10/12] ARM: dts: minimal updates to support spi/mmc on
 am335x-bone

Signed-off-by: Matt Porter <mporter@ti.com>
---
 arch/arm/boot/dts/am335x-bone.dts |   21 +++++++++++++++++++++
 arch/arm/boot/dts/am33xx.dtsi     |    9 +++++++--
 2 files changed, 28 insertions(+), 2 deletions(-)

diff --git a/arch/arm/boot/dts/am335x-bone.dts b/arch/arm/boot/dts/am335x-bone.dts
index 6cdf508..0d9eb8d 100644
--- a/arch/arm/boot/dts/am335x-bone.dts
+++ b/arch/arm/boot/dts/am335x-bone.dts
@@ -119,6 +119,8 @@
 		};
 
 		ldo3_reg: regulator@5 {
+			regulator-min-microvolt = <1800000>;
+			regulator-max-microvolt = <3300000>;
 			regulator-always-on;
 		};
 
@@ -135,3 +137,22 @@
 &cpsw_emac1 {
 	phy_id = "4a101000.mdio:01";
 };
+
+&mmc1 {
+	vmmc-supply = <&ldo3_reg>;
+};
+
+&spi0 {
+	status = "okay";
+};
+
+&spi1 {
+	status = "okay";
+
+	spidev@2 {
+		compatible = "spidev";
+		spi-max-frequency = <1200000>;
+		reg = <0>;
+	};
+};
+
diff --git a/arch/arm/boot/dts/am33xx.dtsi b/arch/arm/boot/dts/am33xx.dtsi
index bc9def8..6994a65 100644
--- a/arch/arm/boot/dts/am33xx.dtsi
+++ b/arch/arm/boot/dts/am33xx.dtsi
@@ -291,16 +291,22 @@
 		mmc1: mmc@48060000 {
 			compatible = "ti,omap3-hsmmc";
 			ti,hwmods = "mmc1";
+			ti,dual-volt;
+			ti,needs-special-reset;
 		};
 
 		mmc2: mmc@481D8000 {
 			compatible = "ti,omap3-hsmmc";
 			ti,hwmods = "mmc2";
+			ti,needs-special-reset;
+			status = "disabled";
 		};
 
 		mmc3: mmc@47810000 {
 			compatible = "ti,omap3-hsmmc";
 			ti,hwmods = "mmc3";
+			ti,needs-special-reset;
+			status = "disabled";
 		};
 
 		usb0_phy: phy0 {
@@ -333,13 +339,12 @@
 			compatible = "ti,omap4-mcspi";
 			#address-cells = <1>;
 			#size-cells = <0>;
-			reg = <0x4830000 0x400>;
+			reg = <0x48030000 0x400>;
 			interrupt-parent = <&intc>;
 			interrupt = <65>;
 			ti,spi-num-cs = <2>;
 			ti,hwmods = "spi0";
 			status = "disabled";
-
 		};
 
 		spi1: spi@481a0000 {
-- 
1.7.7.6

